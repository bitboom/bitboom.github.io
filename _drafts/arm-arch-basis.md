# Arm archtecture basis
## 하드웨어

### 컴퓨터에 전원이 들어오면 CPU는 리셋 벡터를 읽는다.
전원이 들어오면
CPU는 가장 먼저 
`익셉션 벡터 테이블`의 `리셋 벡터`를 읽는다.

`익셉션 벡터 테이블`은
메모리의 첫번째 주소 (0x0000_0000)에 위치 한다.
CPU는 메모리의 시작 위치부터 읽으면 된다.

### 익셉션 벡터 테이블은 메모리의 맨 앞에 위치한다.
익셉션 벡터 테이블은
익셉션과 익셉션 핸들러로 구성 된다.

해당 익셉션이 발생하면
CPU는 프로그램 카운터(PC)를
테이블의 익셉션 오프셋(위치)로 변경한다.
이어서 익셉션 핸들러의 주소로 브랜치하여,
익셉션 핸들러를 실행시킨다.

### 익셉션은 순차적인 프로그램 흐름을 끊는다.
익셉션이 발생하면
CPU가 순차적으로 실행하던
프로그램의 흐름을 끊는다.
주변장치에의해 발생되거나
프로그램 내에 소프트웨어적으로
발생시킨다.

익셉션이 발생하면
익셉션 벡터 테이블을 거쳐
익셉션 핸들러로 진입하기 때문에,
진행중이던 프로그램의 흐름(Context)을
백업, 복원해야한다.

### 익셉션 발생시 하드웨어가 하는 일
ARM 하드웨어는
익셉션이 발생하면,
진행중이던 명령어 실행을 완료하고,
다음 실행 명령어를 레지스터에 저장한다.

이후 익셉션 핸들러가 실행이 완료되면
해당 레지스터를 읽어
다시 다음 명령어를 실행한다.

### 인터럽트는 익셉션이다.
인터럽트(interrupt)는 단어 그대로
현재 프로그램의 실행은 중단시킨다.

익셉션과 같은 개념이며 주로
외부 요인(주변장치)에서 발생하는 것을 지칭한다.

스마트폰의 액정을 터치하거나,
버튼을 누르거나,
파일을 저장하면
인터럽트가 발생한다.

### ARM은 두 종류의 인터럽트를 제공한다.
IRQ(Interrupt Request)와 FIQ(Fast Interruot Request)이다.
단어에서 나타내듯 FIQ는 더 빠른 처리를 할 수 있다.

레지스터 R1 ~ R7은 범용레지스터로
공용으로 쓰이지만,
FIQ는 별도로 R8 ~ R12를 사용 할 수 있다.

FIQ만을 위한 레지스터를 사용할 경우
범용 레지스터를 백업, 복원하는
시간을 절약 할 수 있다.

즉, 컨테스트 오버헤드를 줄일 수 있다.

### 인터럽트가 발생하면 익셉션 핸들러를 호출한다.
인터럽트가 발생하면 종류에 따라,
IRQ 익셉션 혹은 FIQ 익셉션 벡터로 PC가 변경된다.

### 인터럽트를 컨트롤하는 주변장치가 따로 있다.
CPU에는 인터럽트를 감지하는 핀이 IRQ, FIQ 두 핀 뿐이다.?
두 핀만으로는 어떤 인터럽트가 발생했는지는 구분 할 수 없다.

VIC(Vectored Interrupt Controller)와 같은
인터럽트 컨트롤러는 인터럽트 처리를 전담하는 주변장치다.

- 인터럽트가 발생했을 때 해당 인터럽트 종류를 레지스터에 기록
- 인터럽트가 발생했을 때 IRQ 혹은 FIQ에 맞춰서 신호를 발생
- 인터럽트 마스킹을 통해 인터럽트를 비활성화
- 인터럽트간 우선순위

###  인터럽트 서비스 루틴이 호출되기까지 세단계가 있다.
인터럽트 서비스 루틴(ISR; Interrupt Service Routine)은
인터럽트만 전담하는 코드다.

0. (인터럽트 발생) 인터럽트 핸들러 진입
1. 인터럽트 컨트롤러 값을 읽어 인터럽트 소스  판단 (ex. 타이머, 버튼, ...)
2. 인터럽트 소스에 따라 적합한 인터럽트 서비스 루틴 선택
3. **인터럽트 소스를 비활성화**하고 인터럽트 서비스 루틴 진입

인터럽트 컨트롤러를 사용하면,
세 단계를 하드웨어가 모두 처리하고
곧바로 ISR에 진입한다.

### 인터럽트 컨트롤러에서 ISR의 주소를 직접 저장한다.
인터럽트가 발생하면 VIC에 의해서
인터럽트 서비스 루틴으로 PC 값이 바뀐다.

### 정상적이지 않은 프로그램의 중단, Abort도 익셉션이다.
익셉션은 정상적인 프로그램의 흐름을 끊는 것이다.
익셉션 핸들러가 호출되고 나서 다시 흐름을 이어간다.

비정상적인 동작으로 정상적인 프로그램을 진행 할 수 없을 떄,
abort 익셉션이 발생한다.

### Abort 익셉션은 3가지
1. MPU로 보호되는 메모리 영역에 권한 위반
2. AMBA 메모리 버스 에러
3. ECC 로직 에러

### CPU가 메모리의 정보를 읽는 경우는 딱 두가지다.
명령어를 읽거나, 데이터를 읽거나.

명령어를 읽을때 발생하는 abort를 prefetch abort라한다.
데이터를 읽을때 발생하는 abort를 data abort라 한다.
